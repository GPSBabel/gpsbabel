#!/bin/bash -ex
#
# generate coverage report and upload to codacy
which qmake
export PATH=${HOME}/Qt/5.7/gcc_64/bin:$PATH
which qmake

# dont leak unhashed tokens!
set +x
if [ ! -z "${CODACY_PROJECT_TOKEN+x}" ] ; then
  echo -n "CODACY_PROJECT_TOKEN hash: "
  echo $CODACY_PROJECT_TOKEN | sha512sum
else
  echo CODACY_PROJECT_TOKEN not set.
fi
if [ ! -z "${GITHUB_TOKEN+x}" ] ; then
  echo -n "GITHUB_TOKEN hash: "
  echo $GITHUB_TOKEN | sha512sum
else
  echo GITHUB_TOKEN not set.
fi
set -x

wget -nv -c https://oss.sonatype.org/service/local/repositories/releases/content/com/codacy/codacy-coverage-reporter/4.0.1/codacy-coverage-reporter-4.0.1-assembly.jar
qmake
make coverage

